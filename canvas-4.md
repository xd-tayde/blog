# è¯¦è§£H5ä¸­çš„å›¾ç‰‡å¤„ç†ä¸åˆæˆ(å››)

## å¼•è¨€ï¼š

å›¾ç‰‡å¤„ç†ç°åœ¨å·²ç»æˆä¸ºäº†æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„åˆšéœ€ï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿç»å¸¸æœ‰è¿™æ–¹é¢çš„éœ€æ±‚ã€‚å®é™…å‰ç«¯ä¸šåŠ¡ä¸­ï¼Œä¹Ÿç»å¸¸ä¼šæœ‰å¾ˆå¤šçš„é¡¹ç›®éœ€è¦ç”¨åˆ°å›¾ç‰‡åŠ å·¥å’Œå¤„ç†ã€‚ä½†æ˜¯å‰ç«¯çš„å›¾ç‰‡å¤„ç†èƒ½åŠ›åœ¨`js`å’Œè®¾å¤‡æ€§èƒ½çš„é™åˆ¶ä¸‹ï¼Œå…¶å®è¡¨ç°å¹¶ä¸çªå‡ºã€‚ç”±äºå…¬å¸çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè¿‡å»ä¸€æ®µæ—¶é—´æˆ‘å¯¹è¿™æ–¹é¢ç§¯ç´¯äº†ä¸€äº›å¹²è´§å’Œç»éªŒï¼Œè¶ç€å¹´åè¿™æ®µæ—¶é—´æ€»ç»“æˆä¸€ç³»åˆ—æ–‡ç« ä¸å¤§å®¶åˆ†äº«ï¼Œå¸Œæœ›èƒ½å¯¹å„ä½åŠªåŠ›ä¸­çš„å‰ç«¯ç«¥é‹å¸¦æ¥å¯å‘å’Œå¸®åŠ©~~~ğŸ˜ƒ

æœ¬ç³»åˆ—ç°åœ¨æ„æ€æˆä»¥ä¸‹4ä¸ªéƒ¨åˆ†:

- ç®—æ³•ç±»å‹å›¾ç‰‡å¤„ç†æŠ€æœ¯ï¼›
- åŸºç¡€ç±»å‹å›¾ç‰‡å¤„ç†æŠ€æœ¯ä¹‹ç¼©æ”¾ä¸è£å‰ªï¼›
- åŸºç¡€ç±»å‹å›¾ç‰‡å¤„ç†æŠ€æœ¯ä¹‹å›¾ç‰‡åˆæˆï¼›
- åŸºç¡€ç±»å‹å›¾ç‰‡å¤„ç†æŠ€æœ¯ä¹‹æ–‡æ¡ˆåˆæˆï¼›

æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šæåˆ°å¾ˆå¤šåœ¨å®é™…è¿ç”¨ä¸­æ‰€é‡åˆ°çš„å‘æˆ–è€…ç»éªŒï¼Œåº”è¯¥ç®—æ˜¯å¹²è´§æ»¡æ»¡~~å¦‚æœèƒ½é€šè¯»ï¼Œåº”è¯¥èƒ½å¤§å¤§æå‡å¯¹å‰ç«¯å›¾ç‰‡å¤„ç†é¢†åŸŸçš„ç†è§£ï¼Œæœ‰æ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥ä¸æˆ‘æ·±å…¥è®¨è®ºï¼Œå¸Œæœ›æœ¬æ–‡èƒ½è¾¾åˆ°æŠ›ç –å¼•ç‰çš„æ•ˆæœï¼Œè®©å‰ç«¯åœ¨å›¾åƒå¤„ç†æ–¹é¢æœ‰æ›´å¤šçš„å¯èƒ½æ€§ï¼Œæœ‰ä¸è¶³ä¹‹å¤„å¸Œæœ›è°…è§£ã€‚

é€šè¿‡è¿™äº›ç§¯ç´¯ï¼Œæˆ‘å°è£…äº†å‡ ä¸ªé¡¹ç›®ä¸­å¸¸ç”¨çš„åŠŸèƒ½ï¼š

**å›¾ç‰‡åˆæˆ:** [Example](http://f2er.meitu.com/gxd/mcanvas/example/index.html) [Git](https://github.com/xd-tayde/mcanvas)

**å›¾ç‰‡è£å‰ª:** [Example](http://f2er.meitu.com/hmz/imageclip/example/index.html) [Git](https://github.com/ishareme/clipimage)

**äººåƒæŠ é™¤:** [Example](http://f2er.meitu.com/gxd/matting/example/index.html) [Git](https://github.com/xd-tayde/matting)

å” å¨å®Œè¿™äº›è€å¥—è·¯åï¼Œåœ¨è®²å®ŒåŸºç¡€ç±»å‹çš„å›¾ç‰‡å¤„ç†åï¼Œæˆ‘ä»¬å¼€å§‹æ¥ä»‹ç»ç®—æ³•ç±»å‹çš„å›¾ç‰‡å¤„ç†æŠ€æœ¯ï¼~~âœˆï¸âœˆï¸âœˆï¸

è¿™ç±»å‹çš„é‡ç‚¹ä¸»è¦åœ¨äºç®—æ³•å’Œæ€§èƒ½å±‚é¢ï¼Œåœ¨å‰ç«¯ç”±äº`js`åŠè®¾å¤‡æ€§èƒ½çš„é™åˆ¶ï¼Œé€šå¸¸è¡¨ç°å¹¶ä¸ç†æƒ³ã€‚åœ¨çœŸæ­£çš„çº¿ä¸Šä¸šåŠ¡ä¸­ï¼Œä¸ºäº†è¿½æ±‚æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåªèƒ½è¿è¡Œä¸€äº›ç›¸å¯¹æ¯”è¾ƒè½»é‡çº§çš„ï¼Œæ€§èƒ½å¥½çš„ç®—æ³•ã€‚ç”±æœåŠ¡ç«¯æ¥è¿›è¡Œè¿›è¡Œï¼Œä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

> Tips: ç”±äºæˆ‘å¯¹ç®—æ³•æ–¹é¢å¹¶æ²¡æœ‰å¾ˆæ·±çš„ç†è§£ï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦æ˜¯ä¸€äº›ç®—æ³•å¤–å±‚åŠåŸºç¡€åŸç†çš„è®²è§£ï¼Œä¸æ¶‰åŠç®—æ³•æœ¬èº«ã€‚ä¸»è¦å¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æå‡å¯¹å›¾ç‰‡å¤„ç†çš„ç†è§£ã€‚

æˆ‘ä»¬ä»¥ä¸‹é¢ä¸¤ä¸ªğŸŒ°æ¥åšåˆæ­¥çš„äº†è§£ï¼š

## (ä¸€) ä¸‡åœ£èŠ‚å°åº”ç”¨

[å›¾ç‰‡æ¨¡ç³Šæ•ˆæœ(æ‰‹æœºä½“éªŒ)](http://api.meitu.com/front_end/xiuxiu/online_mapp/makeup/index.html?makeupType=251&pic=http://mtapplet.meitudata.com/57ea433108c45eb2b166.jpg)

### æ•ˆæœå›¾å¦‚ä¸‹ï¼š

<div align='center'>
	<img src="./images/mcanvas/blur-border.jpg" width = "400" align=center /><br/>
</div>

è¿™ä¸ªå°åº”ç”¨æ˜¯æˆ‘å¸çš„ä¸€ä¸ªä¸‡åœ£èŠ‚æ´»åŠ¨ã€‚äººç‰©è„¸éƒ¨çš„æœ¨å¶å¦†å®¹ç¡®å®å¾ˆç‚«é…·ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦å¤æ‚çš„äººè„¸è¯†åˆ«ï¼Œæ¨¡å‹æ¯”å¯¹ä»¥åŠå¦†å®¹ç®—æ³•ï¼Œæ”¾åœ¨å‰ç«¯æ€§èƒ½å ªå¿§ï¼Œå› æ­¤è®©æœåŠ¡ç«¯æ¥å¤„ç†ï¼Œæ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œè¾¹æ¡†å’ŒèƒŒæ™¯å›¾çš„æ¨¡ç³Šå¤„ç†ï¼Œè¿™ç±»å‹çš„å¤„ç†å°±æ¯”è¾ƒé€‚åˆæ”¾åœ¨å‰ç«¯äº†ï¼Œé¦–å…ˆæ€§èƒ½èƒ½æ¥å—ï¼Œè€Œä¸”æ›´å…·çµæ´»æ€§ï¼Œèƒ½åœ¨ä¸åŒå…¥å£éšæ—¶æ›¿æ¢ä¸åŒçš„è¾¹æ¡†ç´ æã€‚

å¯¹äºæœåŠ¡ç«¯çš„å¦†å®¹ç®—æ³•ï¼Œç”±äºæˆ‘å¯¹ç®—æ³•å¹¶æ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•å¼€æ·±å…¥æ¢è®¨äº†ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ¥æ¢³ç†ä¸‹å‰ç«¯çš„éƒ¨åˆ†:

- å‘é€åŸå›¾ç»™æœåŠ¡ç«¯ï¼Œæ¥å—å¦†å®¹å¤„ç†åçš„æ•ˆæœå›¾;
- ä¸‹è½½æ•ˆæœå›¾åï¼Œç¼©æ”¾æˆåˆé€‚å¤§å°åè¿›è¡Œæ¨¡ç³ŠåŒ–çš„å¤„ç†ï¼Œå¾—åˆ°æ¨¡ç³Šåçš„ç»“æœå›¾;
- å°†ç»“æœå›¾ / æ¨¡ç³Šå›¾ / è¾¹æ¡†è¿›è¡Œåƒç´ çº§çš„èåˆ; 

> Tips: è¿™é‡Œä½¿ç”¨çš„å…¨æ˜¯åƒç´ çº§åˆ«çš„ç®—æ³•èåˆï¼Œé€šè¿‡åŸºç¡€ç±»å‹çš„åˆæˆï¼ŒåŒæ ·å¯ä»¥å®ç°ã€‚

### ç®—æ³•æ€§èƒ½æå‡

å›¾ç‰‡ç®—æ³•å¤„ç†å®è´¨åŸç†å…¶å®æ˜¯ **éå†åƒç´ ç‚¹ï¼Œå¯¹åƒç´ ç‚¹çš„RGBAå€¼è¿›è¡Œæ”¹é€ **ã€‚å¯¹äºæ”¹é€ ç®—æ³•æœ¬èº«ï¼Œæœ¬æ–‡å°±ä¸æ·±å…¥äº†ï¼Œä¸è¿‡å¯ä»¥ä¸å¤§å®¶åˆ†äº«ä¸‹ç›¸å…³çš„ç»éªŒã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€ä¸ªå¥½çš„ç®—æ³•ï¼Œä¸€ä¸ªæœ€é‡è¦çš„æŒ‡æ ‡ä¾¿æ˜¯æ€§èƒ½ï¼Œè€Œå¦‚ä½•æå‡æ€§èƒ½å‘¢ï¼Ÿä¸€ç§æ˜¯ä»ç®—æ³•å±‚é¢æ¥ä¼˜åŒ–ï¼Œæé«˜å¾ªç¯å†…éƒ¨çš„æ€§èƒ½æˆ–è€…æ›´æ¢éå†çš„æ–¹å¼ï¼Œç®—æ³•ä¸­çš„æ€§èƒ½ä¼šç”±äºéå†çš„å­˜åœ¨è¢«æ”¾å¤§æ— æ•°å€ã€‚å¦ä¸€ç§åˆ™æ˜¯ç¼©å°å›¾ç‰‡å¤§å°ã€‚

åƒç´ ç‚¹çš„éå†æ˜¯ä¸€ä¸ªç®—æ³•çš„é‡è¦æ€§èƒ½æ¶ˆè€—ç‚¹ï¼Œå¾ªç¯æ¬¡æ•°ç›´æ¥å†³å®šç€ç®—æ³•çš„æ€§èƒ½ã€‚è€Œåƒç´ ç‚¹çš„æ•°é‡ä¸å›¾ç‰‡çš„å¤§å°å°ºå¯¸æˆæ­£å‘æŒ‡æ•°çº§å¢é•¿ï¼Œå› æ­¤é€‚å½“çš„ç¼©æ”¾å›¾ç‰‡æºåå†å»å¤„ç†ï¼Œå¯¹æ€§èƒ½çš„æå‡ååˆ†å·¨å¤§ã€‚ä¾‹å¦‚ä¸€å¼ `2000*2000`çš„å›¾ç‰‡,åƒç´ ç‚¹è¶³è¶³æœ‰400ä¸‡ä¸ªï¼Œæ„å‘³ç€éœ€è¦éå†400ä¸‡æ¬¡ï¼Œè€ŒæŠŠå›¾ç‰‡ç¼©å°æˆ `800*800` æ—¶ï¼Œå¾ªç¯æ¬¡æ•°ä¸º64ä¸‡ï¼Œè¿™é‡Œæˆ‘åšè¿‡ä¸€ä¸ªæµ‹è¯•ï¼š

```js
let st = new Date().getTime();
let imgData = [];
for (let i = 0; i < n * 10000; i += 4) {
    let r = getRandom(0,255),
        g = getRandom(0,255),
        b = getRandom(0,255),
        a = 1;
    if (r <= 30 && g <= 30 && b<= 30) {
        a = 0;
    }
    imgData[i] = r;
    imgData[i + 1] = g;
    imgData[i + 2] = b;
    imgData[i + 3] = a;
}
let et = new Date().getTime();
let t = et - st;
console.log(`${n}ä¸‡æ¬¡è€—æ—¶:${et - st}ms`, imgData);
```

æµ‹è¯•ç»“æœä¸º(mac-chrome-20æ¬¡å–å¹³å‡):

| å›¾ç‰‡å°ºå¯¸ |  åƒç´ æ•°é‡  | è€—æ—¶(ms) | ç¼©æ”¾å€æ•° |  æå‡  |
|:-------:|:--------:|:--------:|:------:|:-----:|
|`2000*2000`| 400ä¸‡  |  168   | 1 |  0% |
|`1600*1600`|   256ä¸‡ |  98  |  0.8  | 42% |
|`1200*1200`|   144ä¸‡   |  64   |0.6 | 62% |
|`800*800`|   64ä¸‡   |  32    |0.4 | 81% |
|`400*400`|   16ä¸‡   |  10   |0.2| 94% |

å¯ä»¥çœ‹å‡ºå›¾ç‰‡çš„ç¼©å°ï¼Œå¯¹æ€§èƒ½æœ‰éå¸¸æ˜¾è‘—çš„æå‡ï¼Œè¿™é‡Œæœ‰ä¸ªç‰¹ç‚¹ï¼Œæ€§èƒ½çš„æå‡ä¼šéšç€ç¼©æ”¾ç³»æ•°è€Œè¶Šæ¥è¶Šä½ï¼Œå½“ç¼©æ”¾ç³»æ•°ä¸º0.8æ—¶ï¼Œæ€§èƒ½å·²ç»å¤§å¤§æå‡äº†42%ï¼Œè€Œç»§ç»­ç¼©æ”¾ä¸º0.6æ—¶ï¼Œæ”¶ç›Šä¾¿å¼€å§‹å¤§å¹…é™ä½ï¼Œåªæå‡äº†20%ã€‚åŒæ—¶ç¼©æ”¾å›¾ç‰‡æ„å‘³ç€è´¨é‡çš„ä¸‹é™ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œå†ä¸å½±å“ç»“æœå›¾æ•ˆæœçš„å‰æä¸‹ï¼Œç”±å°½å¯èƒ½åœ°æå‡æ€§èƒ½ï¼Œè¿™éœ€è¦æ ¹æ®ç®—æ³•å¯¹å›¾ç‰‡è´¨é‡çš„è¦æ±‚æ¥å®šã€‚

å¦å¤–ï¼Œå¯¹åŸå›¾çš„è£å‰ªä¹Ÿæ˜¯ä¸ªå¾ˆå¥½çš„åŠæ³•ï¼Œè£å‰ªæ‰å¤šä½™çš„èƒŒæ™¯éƒ¨åˆ†ï¼Œä¹Ÿèƒ½è¾¾åˆ°å‡å°‘éå†æ¬¡æ•°ï¼Œæå‡æ€§èƒ½çš„æ•ˆæœã€‚

### æ¨¡ç³Šç®—æ³•

å°åº”ç”¨ä¸­æ¨¡ç³Šéƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ `StackBlur.js` çš„æ¨¡ç³Šç®—æ³•;ä»£ç å¦‚ä¸‹:

```js
// ç¼©æ”¾å¦†å®¹å›¾;
let srcImg = scaleMid(imgData);

// åˆ›å»ºæ¨¡ç³Šç»“æœå›¾çš„å®¹å™¨ï¼›
let blurCvs = document.createElement('canvas');
let blurCtx = blurCvs.getContext('2d');

// å…ˆå¤åˆ¶ä¸€ä»½åŸå›¾æ•°æ®,ï¼›
let blurImg = blurCtx.createImageData(srcImg.width, srcImg.height);
let size = srcImg.width * srcImg.height * 4;
for (let i = 0; i < size; i++) {
    blurImg.data[i] = srcImg.data[i];
}

// ç¼©æ”¾æˆ400*400çš„å¤§å°è¿›è¡Œæ¨¡ç³Šå¤„ç†ï¼›
blurImg = scale(blurImg, 400);
StackBlur.imageDataRGBA(blurImg, 0, 0, blurImg.width, blurImg.height, 1);

// å¤„ç†å®Œåå†æ”¾å¤§ä¸º800*800;
blurImg = scale(blurImg, 800);
```
### å›¾åƒèåˆ

æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åˆæˆæœ€ç»ˆæ•ˆæœå›¾çš„æ‰€æœ‰ç´ æäº†ï¼Œæ¨¡ç³ŠèƒŒæ™¯ / å¦†å®¹å›¾ / è¾¹æ¡†ç´ æï¼Œæœ€åä¸€æ­¥ä¾¿æ˜¯å°†3è€…è¿›è¡Œèåˆï¼Œèåˆçš„åŸç†æ˜¯æ ¹æ®æœ€ç»ˆæ•ˆæœå›¾åˆ†åŒºåŸŸï¼Œåœ¨ä¸åŒåŒºåŸŸåˆ†åˆ«å¡«å…¥å¯¹åº”çš„ç´ ææ•°æ®:

```js
// å›¾ç‰‡èåˆ
function mix(src, blur, mtl) {
	  // æœ€ç»ˆç»“æœå›¾ä¸ºå›ºå®š800*800ï¼›çºµå‘800çš„æ•°æ®ï¼›
    for (let i = 0; i < 800; i++) {
        let offset1 = 800 * i;
        
        // æ¨ªå‘800çš„æ•°æ®ï¼›
        for (let j = 0; j < 800; j++) {
            let offset = (offset1 + j) * 4;
            
            // åœ¨ç‰¹å®šçš„ä½ç½®å¡«å…¥ç´ æï¼›
            if (i <= 75 || i >= 609 || j <= 126 || j >= 676) {
                let alpha = mtl.data[offset + 3] / 255.0;
                mtl.data[offset] = alpha * mtl.data[offset] + (1 - alpha) * blur.data[offset];
                mtl.data[offset + 1] = alpha * mtl.data[offset + 1] + (1 - alpha) * blur.data[offset + 1];
                mtl.data[offset + 2] = alpha * mtl.data[offset + 2] + (1 - alpha) * blur.data[offset + 2];
                mtl.data[offset + 3] = 255;
            } else {
                let alpha = mtl.data[offset + 3] / 255.0;
                let x = i - 75;
                let y = j - 126;
                let newOffset = (x * 550 + y) * 4;
                mtl.data[offset] = alpha * mtl.data[offset] + (1 - alpha) * src.data[newOffset];
                mtl.data[offset + 1] = alpha * mtl.data[offset + 1] + (1 - alpha) * src.data[newOffset + 1];
                mtl.data[offset + 2] = alpha * mtl.data[offset + 2] + (1 - alpha) * src.data[newOffset + 2];
                mtl.data[offset + 3] = 255;
            }
        }
    }
    return mtl;
}
```

## (äºŒ) æŠ é™¤äººåƒ

è¿™æ˜¯ä¸€ä¸ªæˆ‘æŸå¤©çªå‘å¥‡æƒ³çš„æƒ³æ³•ï¼Œå°±æ˜¯åŸºäºæœåŠ¡ç«¯çš„äººåƒ`mask`å±‚ï¼Œåœ¨å‰ç«¯æŠŠäººåƒæŠ å‡ºï¼Œä¸å¸¦èƒŒæ™¯ï¼Œè¿™æ ·ä¾¿å¯ä»¥è¿›ä¸€æ­¥åšèƒŒæ™¯çš„èåˆå’Œåˆ‡æ¢ï¼Œç°åœ¨å·²ç»ç”¨åœ¨å¤šä¸ªçº¿ä¸Šé¡¹ç›®ä¸­äº†ã€‚

**äººåƒæŠ é™¤:** [Example](http://f2er.meitu.com/gxd/matting/example/index.html) [Git](https://github.com/xd-tayde/matting)

è¿™é‡Œéœ€è¦ç”±æœåŠ¡ç«¯å¤„ç†åçš„ä¸¤å¼ æ•ˆæœå›¾:

å¸¦èƒŒæ™¯çš„ç»“æœå›¾å’Œmaskå›¾:

<div align ='center'>
	<img src="./images/mcanvas/cartoon.jpg" width = "400" align='center' /><br/>
</div>


1ã€æˆ‘ä»¬éœ€è¦å…ˆå°†`mask`å›¾è¿›è¡Œå¤„ç†:

```js
// ç»˜åˆ¶maskï¼›
// mask_zoom: æ—¢ä¸ºäº†ä¼˜åŒ–æ€§èƒ½æ‰€åšçš„ç¼©æ”¾ç³»æ•°;
mask = document.createElement('canvas');
maskCtx = mask.getContext('2d');
mask.width = imgEl.naturalWidth * ops.mask_zoom;
mask.height = imgEl.naturalHeight * ops.mask_zoom / 2;
maskCtx.drawImage(imgEl, 0, - imgEl.naturalHeight * ops.mask_zoom / 2, imgEl.naturalWidth * ops.mask_zoom , imgEl.naturalHeight * ops.mask_zoom);
```

2ã€å»é™¤`mask`çš„é»‘è‰²èƒŒæ™¯ï¼Œå˜æˆé€æ˜è‰²,è¿™é‡Œéœ€è¦ç”¨åˆ°åƒç´ æ“ä½œ:

```js
// è·å–å›¾ç‰‡æ•°æ®ï¼›
let maskData = maskCtx.getImageData(0, 0, mask.width, mask.height);

// éå†æ”¹é€ åƒç´ ç‚¹ï¼Œå°†æ¥è¿‘é»‘è‰²çš„ç‚¹çš„é€æ˜åº¦æ”¹æˆ0;
for (let i = 0; i < data.length; i += 4) {
	let r = data[i],
	    g = data[i + 1],
	    b = data[i + 2];
		
	if (r <= 30 && g <= 30 && b<= 30)data[i + 3] = 0;
}

// å°†æ”¹é€ åçš„æ•°æ®é‡æ–°å¡«å›maskå±‚ä¸­;
maskCtx.putImageData(maskData, 0, 0);
```

3ã€å›¾åƒèåˆï¼Œè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªç¥å¥‡çš„`canvas`æ–¹æ³•ï¼Œç›¸ä¿¡å¤§å®¶å¬è¿‡ï¼Œä½†å¹¶ä¸ç†Ÿæ‚‰ --- `globalCompositeOperation`,è¯¥å€¼å¯ä»¥ä¿®æ”¹`canvas`çš„èåˆæ¨¡å¼ï¼Œæœ‰å¤šç§èåˆæ¨¡å¼å¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯`source-in`;

```js
// åˆ›å»ºæœ€ç»ˆæ•ˆæœå›¾å®¹å™¨ï¼›
result = document.createElement('canvas');
resultCtx = result.getContext('2d');
result.width = imgEl.naturalWidth;
result.height = imgEl.naturalHeight;

// å…ˆç»˜åˆ¶maskå›¾å±‚åšä¸ºèƒŒæ™¯;
resultCtx.drawImage(mask, 0, 0, imgEl.naturalWidth, imgEl.naturalHeight);

// ä¿®æ”¹èåˆæ¨¡å¼
resultCtx.globalCompositeOperation = 'source-in';

// ç»˜åˆ¶å¸¦èƒŒæ™¯çš„ç»“æœå›¾
resultCtx.drawImage(origin, 0, 0);
```

æœ€ç»ˆå¾—åˆ°çš„æ•ˆæœå›¾:

<div align ='center'>
	<img src="./images/mcanvas/matting.png" width = "200" align='center' /><br/>
</div>

æœ€åå°±å¯ä»¥ä½¿ç”¨è¿™ç§äººåƒå›¾ä¸ä»»ä½•èƒŒæ™¯æˆ–è€…ç´ ææ ¹æ®ä¸šåŠ¡éœ€æ±‚å†åšèåˆäº†ã€‚

å…³äºç®—æ³•çº§åˆ«çš„å›¾åƒå¤„ç†å°±å…ˆäº†è§£åˆ°è¿™ï¼Œæ¥ä¸‹æ¥ä¸€ç¯‡æ–‡ç« æ˜¯ä»‹ç»å¦ä¸€ç±»å‹çš„åŸºç¡€ç±»å‹å›¾ç‰‡å¤„ç†ï¼Œç»å¯¹å¹²è´§æ»¡æ»¡å“Ÿã€‚~~ğŸ˜¬ğŸ˜¬ğŸ˜¬ğŸ˜¬ï¼Œå°½æƒ…æœŸå¾…ï¼















